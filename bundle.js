!function(t){var e={};function s(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e,s,n){this.r=t,this.g=e,this.b=s,this.a=n}static average(t){const e=t.reduce((t,e)=>new n(t.r+e.r,t.g+e.g,t.b+e.b,t.a+e.a),new n(0,0,0,0));return new n(e.r/t.length,e.g/t.length,e.b/t.length,e.a/t.length)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}}e.Colour=n},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);document.addEventListener("DOMContentLoaded",()=>{(new n.AnimationLoop).start()},!1)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(3),i=s(4),r=s(0);e.AnimationLoop=class{constructor(){this.width=500,this.height=500,this.canvas=new n.Canvas(this.width,this.height),this.scene=new i.Scene,this.timestamp=new Date,this.timestampElement=document.getElementById("timestamp"),this.frameTimes=[]}start(){this.tick()}tick(){const t=new Date;this.frameTimes=this.frameTimes.filter(e=>t.getTime()-e.getTime()<1e3),this.frameTimes&&(this.timestampElement.textContent=this.frameTimes.length.toString()),this.frameTimes.push(t),this.scene.update();const e=this.generateImage();this.canvas.paint(e),setTimeout(()=>{this.tick()},0)}generateImage(){const t=[];for(let e=0;e<this.height;e++){const s=this.generateImageRow(e);t.push(s)}return t}generateImageRow(t){const e=[];for(let s=0;s<this.width;s++){if(t%4!=0||s%4!=0){e.push(new r.Colour(0,0,0,1));continue}const n=this.colourAtPixel(t,s);e.push(n)}return e}colourAtPixel(t,e){const s=this.scene.camera.getRayAtRelativeXY(t/this.height,e/this.width).getColourOfNearestIntersection(this.scene.getTriangles());return s||new r.Colour(0,0,0,1)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(0);e.Canvas=class{constructor(t,e){const s=document.getElementById("canvas");if(!s)throw new Error("couldn't find 'canvas' on document");this.canvas=s;const i=s.getContext("2d");if(!i)throw new Error("could not get canvas context");this.ctx=i,this.canvas.width=t,this.canvas.height=e,this.previousImage=[];for(let t=0;t<this.canvas.width;t++){const t=[];for(let e=0;e<this.canvas.height;e++)t.push(new n.Colour(0,0,0,0));this.previousImage.push(t)}}paint(t){for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++){if(this.previousImage[e][s].equals(t[e][s]))continue;const n=t[e][s];this.ctx.fillStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",this.ctx.fillRect(e,s,1,1)}this.previousImage=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(5),i=s(6),r=s(9);e.Scene=class{constructor(){const t=new n.Vector(250,250,-200),e=new n.Vector(100,100,100),s=new n.Vector(400,100,100),o=new n.Vector(100,400,100);this.camera=new r.Camera(t,e,s,o),this.drawables=[];const a=new n.Vector(250,100,100),c=new n.Vector(250,200,200),h=c.rotateInYAround(a,-2*Math.PI/3),u=h.rotateInYAround(a,-2*Math.PI/3);this.drawables.push(new i.Parallelepiped(a,c,h,u,(function(){this.defaultAnimation()})))}getTriangles(){return this.drawables.map(t=>t.getTriangles()).reduce((t,e)=>t.concat(e),[])}update(){this.drawables.forEach(t=>t.update())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e,s){this.x=t,this.y=e,this.z=s}isTheZeroVector(){return 0===this.x&&0===this.y&&0===this.z}subtract(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new n(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}rotateInYAround(t,e){const s=new n(t.x,t.y,t.z),i=this.subtract(s);return new n(i.x*Math.cos(e)-i.z*Math.sin(e),i.y,i.z*Math.cos(e)+i.x*Math.sin(e)).add(s)}distanceBetween(t){return Math.abs(Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2)))}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}scaleBy(t){return new n(this.x*t,this.y*t,this.z*t)}}e.Vector=n},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(0),i=s(7);e.Parallelepiped=class{constructor(t,e,s,r,o=(()=>{})){const a=e.subtract(t),c=s.subtract(t),h=r.subtract(t),u=t.add(a).add(c),l=t.add(a).add(h),d=t.add(c).add(h);this.parallelograms=[new i.Parallelogram(t,e,s,new n.Colour(255,0,0,1)),new i.Parallelogram(t,r,e,new n.Colour(0,255,0,1)),new i.Parallelogram(t,s,r,new n.Colour(0,0,255,1)),new i.Parallelogram(r,d,l,new n.Colour(0,255,255,1)),new i.Parallelogram(s,u,d,new n.Colour(255,0,255,1)),new i.Parallelogram(e,l,u,new n.Colour(255,255,0,1))],this.update=o}getTriangles(){return this.parallelograms.map(t=>t.getTriangles()).reduce((t,e)=>t.concat(e),[])}defaultAnimation(){const t=this.parallelograms[0].getTriangles()[0].point0;this.parallelograms.forEach(e=>e.defaultAnimation(t))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(8);e.Parallelogram=class{constructor(t,e,s,i,r=(()=>{})){const o=e.subtract(t),a=s.subtract(t),c=t.add(o).add(a);this.triangles=[new n.Triangle(t,c,s,i),new n.Triangle(t,e,c,i)],this.update=r}getTriangles(){return this.triangles}defaultAnimation(t){this.triangles=this.triangles.map(e=>e.defaultAnimation(t))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e,s,n,i=(()=>{})){if(this.point0=t,this.point1=e,this.point2=s,this.colour=n,this.update=i,this.normal=this.getNormal(),this.normal.isTheZeroVector())throw new Error("This triangle would be degenerate")}getTriangles(){return[this]}defaultAnimation(t){return new n(this.point0.rotateInYAround(t,.01),this.point1.rotateInYAround(t,.01),this.point2.rotateInYAround(t,.01),this.colour,this.update)}getNormal(){return this.point1.subtract(this.point0).crossProduct(this.point2.subtract(this.point0))}}e.Triangle=n},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(10);e.Camera=class{constructor(t,e,s,n){this.position=t,this.topLeft=e,this.topRight=s,this.bottomLeft=n,this.xEdge=this.topRight.subtract(this.topLeft),this.yEdge=this.bottomLeft.subtract(this.topLeft),this.bottomRight=this.topLeft.add(this.xEdge).add(this.yEdge)}getRayAtRelativeXY(t,e){return new n.Ray(this.position,this.topLeft.add(this.xEdge.scaleBy(t)).add(this.yEdge.scaleBy(e)))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e){this.origin=t,this.destination=e,this.direction=this.destination.subtract(this.origin)}interpolate(t,e){if(!this.origin.equals(t.origin))throw new Error("Cannot interpolate between rays with different origins");const s=t.destination.subtract(this.destination);return new n(this.origin,this.destination.add(s.scaleBy(e)))}getColourOfNearestIntersection(t){let e=1/0,s=null;return t.forEach(t=>{const n=this.getIntersection(t);if(n){const i=n.distanceBetween(this.origin);i<e&&(e=i,s=t.colour)}}),s}getIntersection(t){const e=this.origin.subtract(t.point0),s=-t.normal.dot(e);if(s<0)return null;const n=this.direction.dot(t.normal);if(Math.abs(n)<1e-8)return null;const i=s/n,r=this.origin.add(this.direction.scaleBy(i)),o=t.point1.subtract(t.point0),a=t.point2.subtract(t.point0),c=o.dot(o),h=o.dot(a),u=a.dot(a),l=r.subtract(t.point0),d=l.dot(o),g=l.dot(a),p=h*h-c*u,f=(h*g-u*d)/p;if(f<0||f>1)return null;const m=(h*d-c*g)/p;return m<0||f+m>1?null:r}}e.Ray=n}]);
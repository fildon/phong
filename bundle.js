!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,n,s){this.r=t,this.g=e,this.b=n,this.a=s}static average(t){const e=t.reduce((t,e)=>new s(t.r+e.r,t.g+e.g,t.b+e.b,t.a+e.a),new s(0,0,0,0));return new s(e.r/t.length,e.g/t.length,e.b/t.length,e.a/t.length)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}}e.Colour=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(2);document.addEventListener("DOMContentLoaded",()=>{(new s.AnimationLoop).start()},!1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(3),i=n(4),r=n(0);e.AnimationLoop=class{constructor(){this.width=500,this.height=500,this.canvas=new s.Canvas(this.width,this.height),this.scene=new i.Scene,this.timestamp=new Date,this.timestampElement=document.getElementById("timestamp")}start(){this.tick()}tick(){const t=new Date;let e=1e3/(t.getTime()-this.timestamp.getTime());e=Math.floor(100*e)/100,this.timestampElement.textContent=e.toString(),this.timestamp=t,this.scene.update();const n=this.generateImage();this.canvas.paint(n),setTimeout(()=>{this.tick()},0)}generateImage(){const t=[];for(let e=0;e<this.height;e++){const n=this.generateImageRow(e);t.push(n)}return t}generateImageRow(t){const e=[];for(let n=0;n<this.width;n++){if(t%4!=0||n%4!=0){e.push(new r.Colour(0,0,0,1));continue}const s=this.colourAtPixel(t,n);e.push(s)}return e}colourAtPixel(t,e){const n=this.scene.camera.getRayAtRelativeXY(t/this.height,e/this.width).getColourOfNearestIntersection(this.scene.getTriangles());return n||new r.Colour(0,0,0,1)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0);e.Canvas=class{constructor(t,e){const n=document.getElementById("canvas");if(!n)throw new Error("couldn't find 'canvas' on document");this.canvas=n;const i=n.getContext("2d");if(!i)throw new Error("could not get canvas context");this.ctx=i,this.canvas.width=t,this.canvas.height=e,this.previousImage=[];for(let t=0;t<this.canvas.width;t++){const t=[];for(let e=0;e<this.canvas.height;e++)t.push(new s.Colour(0,0,0,0));this.previousImage.push(t)}}paint(t){for(let e=0;e<t.length;e++)for(let n=0;n<t[e].length;n++){if(this.previousImage[e][n].equals(t[e][n]))continue;const s=t[e][n];this.ctx.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",this.ctx.fillRect(e,n,1,1)}this.previousImage=t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(5),i=n(6),r=n(9);e.Scene=class{constructor(){const t=new s.Vector(250,250,-200),e=new s.Vector(100,100,100),n=new s.Vector(400,100,100),o=new s.Vector(100,400,100);this.camera=new r.Camera(t,e,n,o),this.drawables=[];const a=new s.Vector(250,100,100),c=new s.Vector(250,200,200),u=c.rotateInYAround(a,-2*Math.PI/3),h=u.rotateInYAround(a,-2*Math.PI/3);this.drawables.push(new i.Parallelepiped(a,c,u,h,(function(){this.defaultAnimation()})))}getTriangles(){return this.drawables.map(t=>t.getTriangles()).reduce((t,e)=>t.concat(e),[])}update(){this.drawables.forEach(t=>t.update())}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,n){this.x=t,this.y=e,this.z=n}isTheZeroVector(){return 0===this.x&&0===this.y&&0===this.z}subtract(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new s(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}rotateInYAround(t,e){const n=new s(t.x,t.y,t.z),i=this.subtract(n);return new s(i.x*Math.cos(e)-i.z*Math.sin(e),i.y,i.z*Math.cos(e)+i.x*Math.sin(e)).add(n)}distanceBetween(t){return Math.abs(Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2)))}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}scaleBy(t){return new s(this.x*t,this.y*t,this.z*t)}}e.Vector=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),i=n(7);e.Parallelepiped=class{constructor(t,e,n,r,o=(()=>{})){const a=e.subtract(t),c=n.subtract(t),u=r.subtract(t),h=t.add(a).add(c),l=t.add(a).add(u),d=t.add(c).add(u);this.parallelograms=[new i.Parallelogram(t,e,n,new s.Colour(255,0,0,1)),new i.Parallelogram(t,r,e,new s.Colour(0,255,0,1)),new i.Parallelogram(t,n,r,new s.Colour(0,0,255,1)),new i.Parallelogram(r,d,l,new s.Colour(0,255,255,1)),new i.Parallelogram(n,h,d,new s.Colour(255,0,255,1)),new i.Parallelogram(e,l,h,new s.Colour(255,255,0,1))],this.update=o}getTriangles(){return this.parallelograms.map(t=>t.getTriangles()).reduce((t,e)=>t.concat(e),[])}defaultAnimation(){const t=this.parallelograms[0].getTriangles()[0].point0;this.parallelograms.forEach(e=>e.defaultAnimation(t))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(8);e.Parallelogram=class{constructor(t,e,n,i,r=(()=>{})){const o=e.subtract(t),a=n.subtract(t),c=t.add(o).add(a);this.triangles=[new s.Triangle(t,c,n,i),new s.Triangle(t,e,c,i)],this.update=r}getTriangles(){return this.triangles}defaultAnimation(t){this.triangles=this.triangles.map(e=>e.defaultAnimation(t))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,n,s,i=(()=>{})){if(this.point0=t,this.point1=e,this.point2=n,this.colour=s,this.update=i,this.normal=this.getNormal(),this.normal.isTheZeroVector())throw new Error("This triangle would be degenerate")}getTriangles(){return[this]}defaultAnimation(t){return new s(this.point0.rotateInYAround(t,.01),this.point1.rotateInYAround(t,.01),this.point2.rotateInYAround(t,.01),this.colour,this.update)}getNormal(){return this.point1.subtract(this.point0).crossProduct(this.point2.subtract(this.point0))}}e.Triangle=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(10);e.Camera=class{constructor(t,e,n,s){this.position=t,this.topLeft=e,this.topRight=n,this.bottomLeft=s,this.xEdge=this.topRight.subtract(this.topLeft),this.yEdge=this.bottomLeft.subtract(this.topLeft),this.bottomRight=this.topLeft.add(this.xEdge).add(this.yEdge)}getRayAtRelativeXY(t,e){return new s.Ray(this.position,this.topLeft.add(this.xEdge.scaleBy(t)).add(this.yEdge.scaleBy(e)))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e){this.origin=t,this.destination=e,this.direction=this.destination.subtract(this.origin)}interpolate(t,e){if(!this.origin.equals(t.origin))throw new Error("Cannot interpolate between rays with different origins");const n=t.destination.subtract(this.destination);return new s(this.origin,this.destination.add(n.scaleBy(e)))}getColourOfNearestIntersection(t){let e=1/0,n=null;return t.forEach(t=>{const s=this.getIntersection(t);if(s){const i=s.distanceBetween(this.origin);i<e&&(e=i,n=t.colour)}}),n}getIntersection(t){const e=this.origin.subtract(t.point0),n=-t.normal.dot(e);if(n<0)return null;const s=this.direction.dot(t.normal);if(Math.abs(s)<1e-8)return null;const i=n/s,r=this.origin.add(this.direction.scaleBy(i)),o=t.point1.subtract(t.point0),a=t.point2.subtract(t.point0),c=o.dot(o),u=o.dot(a),h=a.dot(a),l=r.subtract(t.point0),d=l.dot(o),g=l.dot(a),p=u*u-c*h,f=(u*g-h*d)/p;if(f<0||f>1)return null;const m=(u*d-c*g)/p;return m<0||f+m>1?null:r}}e.Ray=s}]);
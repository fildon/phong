!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}static average(t){const e=t.reduce((t,e)=>new i(t.r+e.r,t.g+e.g,t.b+e.b,t.a+e.a),new i(0,0,0,0));return new i(e.r/t.length,e.g/t.length,e.b/t.length,e.a/t.length)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}}e.Colour=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s){this.x=t,this.y=e,this.z=s}subtract(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}rotateInYAround(t,e){const s=new i(t.x,t.y,t.z),r=this.subtract(s);return new i(r.x*Math.cos(e)-r.z*Math.sin(e),r.y,r.z*Math.cos(e)+r.x*Math.sin(e)).add(s)}}e.Vector=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);document.addEventListener("DOMContentLoaded",()=>{(new i.AnimationLoop).start()},!1)},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4),r=s(5),n=s(0),o=s(1);e.AnimationLoop=class{constructor(){this.width=500,this.height=500,this.canvas=new i.Canvas(this.width,this.height),this.scene=new r.Scene,this.timestamp=new Date,this.timestampElement=document.getElementById("timestamp")}start(){this.tick()}tick(){const t=new Date;let e=1e3/(t.getTime()-this.timestamp.getTime());e=Math.floor(100*e)/100,this.timestampElement.textContent=e.toString(),this.timestamp=t,this.scene.update();const s=this.generateImage();this.canvas.paint(s),setTimeout(()=>{this.tick()},0)}generateImage(){const t=[];for(let e=0;e<this.height;e++){const s=this.generateImageRow(e);t.push(s)}return t}generateImageRow(t){const e=[];for(let s=0;s<this.width;s++){if(t%4!=0||s%4!=0){e.push(new n.Colour(0,0,0,1));continue}const i=this.colourAtEndOfRay(t,s);e.push(i)}return e}colourAtEndOfRay(t,e){let s=new n.Colour(0,0,0,1),i=1/0;return this.scene.getPolys().forEach(r=>{const n=this.getWindingNumber(t,e,r);n&&n<i&&(s=r.colour,i=n)}),s}getWindingNumber(t,e,s){let i=0;const r=s.vertices.length;for(let n=0;n<r;n++){const h=s.vertices[n],c=s.vertices[(n+1)%r];h.y<=e?c.y>e&&this.isLeft(h,c,new o.Vector(t,e,0))>0&&i++:c.y<=e&&this.isLeft(h,c,new o.Vector(t,e,0))<0&&i--}return i?s.calculateZ(t,e):null}isLeft(t,e,s){return(e.x-t.x)*(s.y-t.y)-(s.x-t.x)*(e.y-t.y)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.Canvas=class{constructor(t,e){const s=document.getElementById("canvas");if(!s)throw new Error("couldn't find 'canvas' on document");this.canvas=s;const r=s.getContext("2d");if(!r)throw new Error("could not get canvas context");this.ctx=r,this.canvas.width=t,this.canvas.height=e,this.previousImage=[];for(let t=0;t<this.canvas.width;t++){const t=[];for(let e=0;e<this.canvas.height;e++)t.push(new i.Colour(0,0,0,0));this.previousImage.push(t)}}paint(t){for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++){if(this.previousImage[e][s].equals(t[e][s]))continue;const i=t[e][s];this.ctx.fillStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",this.ctx.fillRect(e,s,1,1)}this.previousImage=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1),r=s(6);e.Scene=class{constructor(){this.drawables=[];const t=new i.Vector(250,100,100),e=new i.Vector(250,200,200),s=e.rotateInYAround(t,2*Math.PI/3),n=s.rotateInYAround(t,2*Math.PI/3);this.drawables.push(new r.Cube(t,e,s,n,(function(){this.rotate()})))}getPolys(){return this.drawables.map(t=>t.getPolys()).reduce((t,e)=>t.concat(e),[])}update(){this.drawables.forEach(t=>t.update())}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(7),r=s(8);e.Cube=class{constructor(t,e,s,i,r=(()=>{})){this.v0=t,this.v1=e,this.v2=s,this.v3=i;const n=e.subtract(t),o=s.subtract(t),h=i.subtract(t);this.v12=t.add(n).add(o),this.v13=t.add(n).add(h),this.v23=t.add(o).add(h),this.v123=t.add(n).add(o).add(h),this.update=r}getPolys(){return[new i.Poly([this.v0,this.v1,this.v12,this.v2],new r.Colour(255,0,0,1)),new i.Poly([this.v0,this.v1,this.v13,this.v3],new r.Colour(0,255,0,1)),new i.Poly([this.v0,this.v2,this.v23,this.v3],new r.Colour(0,0,255,1)),new i.Poly([this.v3,this.v13,this.v123,this.v23],new r.Colour(0,255,255,1)),new i.Poly([this.v2,this.v12,this.v123,this.v23],new r.Colour(255,0,255,1)),new i.Poly([this.v1,this.v12,this.v123,this.v13],new r.Colour(255,255,0,1))]}rotate(){this.v0=this.v0.rotateInYAround(this.v0,.01),this.v1=this.v1.rotateInYAround(this.v0,.01),this.v2=this.v2.rotateInYAround(this.v0,.01),this.v3=this.v3.rotateInYAround(this.v0,.01),this.v12=this.v12.rotateInYAround(this.v0,.01),this.v13=this.v13.rotateInYAround(this.v0,.01),this.v23=this.v23.rotateInYAround(this.v0,.01),this.v123=this.v123.rotateInYAround(this.v0,.01)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s=(()=>{})){if(t.length<3)throw new Error("too few vertices to define poly");if(4===t.length&&!i.coplanar(t))throw new Error("these vertices are not coplanar");this.vertices=t,this.colour=e,this.update=s}static coplanar(t){return t[1].subtract(t[0]).dotProduct(t[2].subtract(t[0]).crossProduct(t[3].subtract(t[0])))<.01}getPolys(){return[this]}calculateZ(t,e){const s=[this.vertices[0].x-this.vertices[1].x,this.vertices[0].y-this.vertices[1].y,this.vertices[0].z-this.vertices[1].z],i=[this.vertices[0].x-this.vertices[2].x,this.vertices[0].y-this.vertices[2].y,this.vertices[0].z-this.vertices[2].z],r=s[1]*i[2]-s[2]*i[1],n=s[2]*i[0]-s[0]*i[2],o=s[0]*i[1]-s[1]*i[0];return 1/o*(r*this.vertices[0].x+n*this.vertices[0].y)+this.vertices[0].z+-r/o*t+-n/o*e}}e.Poly=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}static average(t){const e=t.reduce((t,e)=>new i(t.r+e.r,t.g+e.g,t.b+e.b,t.a+e.a),new i(0,0,0,0));return new i(e.r/t.length,e.g/t.length,e.b/t.length,e.a/t.length)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}}e.Colour=i}]);
!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,n,i){this.r=t,this.g=e,this.b=n,this.a=i}static average(t){const e=t.reduce((t,e)=>new i(t.r+e.r,t.g+e.g,t.b+e.b,t.a+e.a),new i(0,0,0,0));return new i(e.r/t.length,e.g/t.length,e.b/t.length,e.a/t.length)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}}e.Colour=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,n){this.x=t,this.y=e,this.z=n}isTheZeroVector(){return 0===this.x&&0===this.y&&0===this.z}subtract(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}rotateInYAround(t,e){const n=new i(t.x,t.y,t.z),s=this.subtract(n);return new i(s.x*Math.cos(e)-s.z*Math.sin(e),s.y,s.z*Math.cos(e)+s.x*Math.sin(e)).add(n)}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2))}}e.Vector=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(3);document.addEventListener("DOMContentLoaded",()=>{(new i.AnimationLoop).start()},!1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(4),s=n(5),o=n(0),r=n(1);e.AnimationLoop=class{constructor(){this.width=500,this.height=500,this.canvas=new i.Canvas(this.width,this.height),this.scene=new s.Scene,this.timestamp=new Date,this.timestampElement=document.getElementById("timestamp")}start(){this.tick()}tick(){const t=new Date;let e=1e3/(t.getTime()-this.timestamp.getTime());e=Math.floor(100*e)/100,this.timestampElement.textContent=e.toString(),this.timestamp=t,this.scene.update();const n=this.generateImage();this.canvas.paint(n),setTimeout(()=>{this.tick()},0)}generateImage(){const t=[];for(let e=0;e<this.height;e++){const n=this.generateImageRow(e);t.push(n)}return t}generateImageRow(t){const e=[];for(let n=0;n<this.width;n++){if(t%4!=0||n%4!=0){e.push(new o.Colour(0,0,0,1));continue}const i=this.colourAtEndOfRay(t,n);e.push(i)}return e}colourAtEndOfRay(t,e){let n=new o.Colour(0,0,0,1),i=1/0;return this.scene.getTriangles().forEach(s=>{const o=this.getWindingNumber(t,e,s);o&&o<i&&(n=s.colour,i=o)}),n}getWindingNumber(t,e,n){let i=0;const s=[n.point0,n.point1,n.point2];for(let n=0;n<3;n++){const o=s[n],a=s[(n+1)%3];o.y<=e?a.y>e&&this.isLeft(o,a,new r.Vector(t,e,0))>0&&i++:a.y<=e&&this.isLeft(o,a,new r.Vector(t,e,0))<0&&i--}return i?n.calculateZ(t,e):null}isLeft(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(0);e.Canvas=class{constructor(t,e){const n=document.getElementById("canvas");if(!n)throw new Error("couldn't find 'canvas' on document");this.canvas=n;const s=n.getContext("2d");if(!s)throw new Error("could not get canvas context");this.ctx=s,this.canvas.width=t,this.canvas.height=e,this.previousImage=[];for(let t=0;t<this.canvas.width;t++){const t=[];for(let e=0;e<this.canvas.height;e++)t.push(new i.Colour(0,0,0,0));this.previousImage.push(t)}}paint(t){for(let e=0;e<t.length;e++)for(let n=0;n<t[e].length;n++){if(this.previousImage[e][n].equals(t[e][n]))continue;const i=t[e][n];this.ctx.fillStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",this.ctx.fillRect(e,n,1,1)}this.previousImage=t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(1),s=n(6);e.Scene=class{constructor(){this.drawables=[];const t=new i.Vector(250,100,100),e=new i.Vector(250,200,200),n=e.rotateInYAround(t,2*Math.PI/3),o=n.rotateInYAround(t,2*Math.PI/3);this.drawables.push(new s.Parallelepiped(t,e,n,o,(function(){this.defaultAnimation()})))}getTriangles(){return this.drawables.map(t=>t.getTriangles()).reduce((t,e)=>t.concat(e),[])}update(){this.drawables.forEach(t=>t.update())}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(0),s=n(7);e.Parallelepiped=class{constructor(t,e,n,o,r=(()=>{})){this.point0=t,this.point1=e,this.point2=n,this.point3=o;const a=e.subtract(t),h=n.subtract(t),u=o.subtract(t);this.point12=t.add(a).add(h),this.point13=t.add(a).add(u),this.point23=t.add(h).add(u),this.point123=t.add(a).add(h).add(u),this.parallelograms=[new s.Parallelogram(this.point0,this.point1,this.point2,new i.Colour(255,0,0,1)),new s.Parallelogram(this.point0,this.point3,this.point1,new i.Colour(0,255,0,1)),new s.Parallelogram(this.point0,this.point2,this.point3,new i.Colour(0,0,255,1)),new s.Parallelogram(this.point3,this.point23,this.point13,new i.Colour(0,255,255,1)),new s.Parallelogram(this.point2,this.point12,this.point23,new i.Colour(255,0,255,1)),new s.Parallelogram(this.point1,this.point13,this.point12,new i.Colour(255,255,0,1))],this.update=r}getTriangles(){return this.parallelograms.map(t=>t.getTriangles()).reduce((t,e)=>t.concat(e),[])}defaultAnimation(){const t=this.parallelograms[0].getTriangles()[0].point0;this.parallelograms.forEach(e=>e.defaultAnimation(t))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(8);e.Parallelogram=class{constructor(t,e,n,s,o=(()=>{})){const r=e.subtract(t),a=n.subtract(t),h=t.add(r).add(a);this.triangles=[new i.Triangle(t,h,n,s),new i.Triangle(t,e,h,s)],this.update=o}getTriangles(){return this.triangles}defaultAnimation(t){this.triangles=this.triangles.map(e=>e.defaultAnimation(t))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,n,i,s=(()=>{})){if(this.point0=t,this.point1=e,this.point2=n,this.colour=i,this.update=s,this.getNormal().isTheZeroVector())throw new Error("This triangle would be degenerate")}getTriangles(){return[this]}calculateZ(t,e){const n=this.getNormal(),i=n.x,s=n.y,o=n.z;return 1/o*(i*this.point0.x+s*this.point0.y)+this.point0.z+-i/o*t+-s/o*e}defaultAnimation(t){return new i(this.point0.rotateInYAround(t,.01),this.point1.rotateInYAround(t,.01),this.point2.rotateInYAround(t,.01),this.colour,this.update)}getNormal(){return this.point1.subtract(this.point0).crossProduct(this.point2.subtract(this.point0))}}e.Triangle=i}]);
(()=>{"use strict";var t={582:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationLoop=void 0;const i=s(601),n=s(80),r=s(893);e.AnimationLoop=class{constructor(){this.width=500,this.height=500,this.canvas=new i.Canvas(this.width,this.height),this.scene=new n.Scene,this.timestampElement=document.getElementById("timestamp"),this.memoElement=document.getElementById("memo"),this.frameTimes=[],this.frameMemo=[],this.frameIndex=0}start(){this.tick()}tick(){const t=new Date;this.frameTimes=this.frameTimes.filter((e=>t.getTime()-e.getTime()<1e3)),this.timestampElement.textContent=this.frameTimes.length.toString(),this.frameTimes.push(t),this.scene.update();const e=this.generateImage(this.frameIndex);this.canvas.paint(e),this.frameIndex=(this.frameIndex+1)%100,setTimeout((()=>{this.tick()}),0)}generateImage(t){if(this.frameMemo[t])return this.frameMemo[t];const e=[];for(let t=0;t<this.height;t++){const s=this.generateImageRow(t);e.push(s)}return this.frameMemo[t]=e,this.memoElement.textContent=this.frameMemo.length.toString(),e}generateImageRow(t){const e=[];for(let s=0;s<this.width;s++){if(t%2!=0||s%2!=0){e.push(new r.Colour(0,0,0,1));continue}const i=this.colourAtPixel(t,s);e.push(i)}return e}colourAtPixel(t,e){return this.scene.camera.getRayAtRelativeXY(t/this.height,e/this.width).getColourOfNearestIntersection(this.scene.getTriangles())||new r.Colour(0,0,0,1)}}},165:(t,e,s)=>{const i=s(582);document.addEventListener("DOMContentLoaded",(()=>{(new i.AnimationLoop).start()}),!1)},686:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;const i=s(869);e.Camera=class{constructor(t,e,s,i){this.position=t,this.topLeft=e,this.topRight=s,this.bottomLeft=i,this.xEdge=this.topRight.subtract(this.topLeft),this.yEdge=this.bottomLeft.subtract(this.topLeft),this.bottomRight=this.topLeft.add(this.xEdge).add(this.yEdge)}getRayAtRelativeXY(t,e){return new i.Ray(this.position,this.topLeft.add(this.xEdge.scaleBy(t)).add(this.yEdge.scaleBy(e)))}}},601:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;const i=s(893);e.Canvas=class{constructor(t,e){const s=document.getElementById("canvas");if(!s)throw new Error("couldn't find 'canvas' on document");this.canvas=s;const n=s.getContext("2d");if(!n)throw new Error("could not get canvas context");this.ctx=n,this.canvas.width=t,this.canvas.height=e,this.previousImage=[];for(let t=0;t<this.canvas.width;t++){const t=[];for(let e=0;e<this.canvas.height;e++)t.push(new i.Colour(0,0,0,0));this.previousImage.push(t)}}paint(t){for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++){if(this.previousImage[e][s].equals(t[e][s]))continue;const i=t[e][s];this.ctx.fillStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",this.ctx.fillRect(e,s,1,1)}this.previousImage=t}}},893:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Colour=void 0;class s{constructor(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}static average(t){const e=t.reduce(((t,e)=>new s(t.r+e.r,t.g+e.g,t.b+e.b,t.a+e.a)),new s(0,0,0,0));return new s(e.r/t.length,e.g/t.length,e.b/t.length,e.a/t.length)}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}}e.Colour=s},874:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Parallelepiped=void 0;const i=s(893),n=s(665);e.Parallelepiped=class{constructor(t,e,s,r,o){const a=e.subtract(t),h=s.subtract(t),l=r.subtract(t),c=t.add(a).add(h),u=t.add(a).add(l),d=t.add(h).add(l);this.parallelograms=[new n.Parallelogram(t,e,s,new i.Colour(255,0,0,1)),new n.Parallelogram(t,r,e,new i.Colour(0,255,0,1)),new n.Parallelogram(t,s,r,new i.Colour(0,0,255,1)),new n.Parallelogram(r,d,u,new i.Colour(0,255,255,1)),new n.Parallelogram(s,c,d,new i.Colour(255,0,255,1)),new n.Parallelogram(e,u,c,new i.Colour(255,255,0,1))],this.update=o||this.defaultAnimation}getTriangles(){return this.parallelograms.map((t=>t.getTriangles())).reduce(((t,e)=>t.concat(e)),[])}defaultAnimation(){const t=this.parallelograms[0].getTriangles()[0].point0;this.parallelograms.forEach((e=>e.defaultAnimation(t)))}}},665:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Parallelogram=void 0;const i=s(818);e.Parallelogram=class{constructor(t,e,s,n,r=(()=>{})){const o=e.subtract(t),a=s.subtract(t),h=t.add(o).add(a);this.triangles=[new i.Triangle(t,h,s,n),new i.Triangle(t,e,h,n)],this.update=r}getTriangles(){return this.triangles}defaultAnimation(t){this.triangles=this.triangles.map((e=>e.defaultAnimation(t)))}}},818:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Triangle=void 0;class s{constructor(t,e,s,i,n=(()=>{})){if(this.point0=t,this.point1=e,this.point2=s,this.colour=i,this.update=n,this.normal=this.getNormal(),this.normal.isTheZeroVector())throw new Error("This triangle would be degenerate")}getTriangles(){return[this]}defaultAnimation(t){return new s(this.point0.rotateInYAround(t,2*Math.PI/100),this.point1.rotateInYAround(t,2*Math.PI/100),this.point2.rotateInYAround(t,2*Math.PI/100),this.colour,this.update)}getNormal(){return this.point1.subtract(this.point0).crossProduct(this.point2.subtract(this.point0))}}e.Triangle=s},869:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0;class s{constructor(t,e){this.origin=t,this.destination=e,this.direction=this.destination.subtract(this.origin)}interpolate(t,e){if(!this.origin.equals(t.origin))throw new Error("Cannot interpolate between rays with different origins");const i=t.destination.subtract(this.destination);return new s(this.origin,this.destination.add(i.scaleBy(e)))}getColourOfNearestIntersection(t){let e=1/0,s=null;return t.forEach((t=>{const i=this.getIntersection(t);if(i){const n=i.distanceBetween(this.origin);n<e&&(e=n,s=t.colour)}})),s}getIntersection(t){const e=this.origin.subtract(t.point0),s=-t.normal.dot(e);if(s<0)return null;const i=this.direction.dot(t.normal);if(Math.abs(i)<1e-8)return null;const n=s/i,r=this.origin.add(this.direction.scaleBy(n)),o=t.point1.subtract(t.point0),a=t.point2.subtract(t.point0),h=o.dot(o),l=o.dot(a),c=a.dot(a),u=r.subtract(t.point0),d=u.dot(o),g=u.dot(a),m=l*l-h*c,p=(l*g-c*d)/m;if(p<0||p>1)return null;const w=(l*d-h*g)/m;return w<0||p+w>1?null:r}}e.Ray=s},320:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vector=void 0;class s{constructor(t,e,s){this.x=t,this.y=e,this.z=s}isTheZeroVector(){return 0===this.x&&0===this.y&&0===this.z}subtract(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new s(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}rotateInYAround(t,e){const i=new s(t.x,t.y,t.z),n=this.subtract(i);return new s(n.x*Math.cos(e)-n.z*Math.sin(e),n.y,n.z*Math.cos(e)+n.x*Math.sin(e)).add(i)}distanceBetween(t){return Math.abs(Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2)))}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}scaleBy(t){return new s(this.x*t,this.y*t,this.z*t)}}e.Vector=s},80:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;const i=s(320),n=s(874),r=s(686);e.Scene=class{constructor(){const t=new i.Vector(250,250,-200),e=new i.Vector(100,100,100),s=new i.Vector(400,100,100),o=new i.Vector(100,400,100);this.camera=new r.Camera(t,e,s,o),this.drawables=[];const a=new i.Vector(250,100,100),h=new i.Vector(250,200,200),l=h.rotateInYAround(a,-2*Math.PI/3),c=l.rotateInYAround(a,-2*Math.PI/3);this.drawables.push(new n.Parallelepiped(a,h,l,c))}getTriangles(){return this.drawables.map((t=>t.getTriangles())).reduce(((t,e)=>t.concat(e)),[])}update(){this.drawables.forEach((t=>t.update()))}}}},e={};!function s(i){if(e[i])return e[i].exports;var n=e[i]={exports:{}};return t[i](n,n.exports,s),n.exports}(165)})();